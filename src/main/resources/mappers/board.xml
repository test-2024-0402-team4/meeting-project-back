<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.meeteam4.meeting.repository.BoardMapper">

    <resultMap id="BoardResultMap" type="com.meeteam4.meeting.entity.StudentBoard">
        <id property="studentBoardId" column="student_board_id"/>
        <result property="studentId" column="student_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="theme" column="theme"/>
        <result property="viewCount" column="view_count"/>
        <result property="createDate" column="create_date"/>
        <result property="updateDate" column="update_date"/>
    </resultMap>

    <resultMap id="CommentResultMap" type="com.meeteam4.meeting.entity.StudentComment">
        <id property="studentCommentId" column="student_comment_id"/>
        <result property="studentBoardId" column="student_board_id"/>
        <result property="studentUserId" column="student_user_id"/>
        <result property="comment" column="comment"/>
        <result property="createDate" column="create_date"/>
        <result property="updateDate" column="update_date"/>

    </resultMap>

    <resultMap id="BoardTcResultMap" type="com.meeteam4.meeting.entity.TeacherBoard">
        <id property="teacherBoardId" column="teacher_board_id"/>
        <result property="teacherId" column="teacher_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="viewCount" column="view_count"/>
        <result property="createDate" column="create_date"/>
        <result property="updateDate" column="update_date"/>
    </resultMap>

    <resultMap id="TeacherCommentResultMap" type="com.meeteam4.meeting.entity.TeacherComment">
        <id property="teacherCommentId" column="teacher_comment_id"/>
        <result property="teacherBoardId" column="teacher_board_id"/>
        <result property="teacherId" column="teacher_id"/>
        <result property="comment" column="comment"/>
        <result property="createDate" column="create_date"/>
        <result property="updateDate" column="update_date"/>

    </resultMap>

    <resultMap id="BoardStudyResultMap" type="com.meeteam4.meeting.entity.StudyBoard">
        <id property="studyBoardId" column="study_board_id"/>
        <result property="userId" column="user_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="viewCount" column="view_count"/>
        <result property="createDate" column="create_date"/>
        <result property="updateDate" column="update_date"/>
    </resultMap>


    <insert id="saveBoard" parameterType="com.meeteam4.meeting.entity.StudentBoard">
        insert into student_board_tb
        values(
            0,
            #{studentId},
            #{title},
            #{content},
            #{theme},
            #{viewCount},
            now(),
            now()
        )
    </insert>

    <select id="searchBoard" resultMap="BoardResultMap">
        select
             sbt.student_board_id,
             sbt.student_id,
             sbt.title,
             sbt.create_date,
             sbt.view_count
        from
            student_board_tb sbt
        where
            1=1
        <choose>
        <when test="count != -1 ">
            and(
            title like concat('%', #{searchText},'%')
            )
        </when>
        </choose>
        limit #{startIndex}, #{count}

    </select>

    <select id="getStudentCount" resultType="integer">
        select
            count(*)
        from
            student_board_tb
        where
        1=1
        <choose>
            <when test="count != -1 ">
                and(
                title like concat('%', #{searchText},'%')
                )
            </when>
        </choose>

    </select>

    <select id="getSingleBoard" resultMap="BoardResultMap">
        select
            student_board_id,
            title,
            create_date,
            content,
            view_count
        from
            student_board_tb
        where
            student_board_id = #{studentBoardId};

    </select>

    <delete id="deleteBoardByBoardId">
        delete
        from
            student_board_tb
        where
            student_board_id = #{studentBoardId}

    </delete>

    <update id="updateBoardByBoardId" parameterType="com.meeteam4.meeting.entity.StudentBoard">
        update
            student_board_tb
        set
            title = #{title},
            content = #{content},
            theme = #{theme},
            update_date = now()
        where
            student_board_id = #{studentBoardId}

    </update>

    <insert id="saveComment" parameterType="com.meeteam4.meeting.entity.StudentComment">
        insert into
            student_comment_tb
        values(
            0,
            #{studentBoardId},
            #{studentUserId},
            #{comment},
            now(),
            now()
        )

    </insert>

    <select id="getStudentComment" resultMap="CommentResultMap">
        select
            student_comment_id,
            student_board_id,
            student_user_id,
            comment,
            create_date,
            update_date
        from
            student_comment_tb
        where
        student_board_id = #{studentBoardId};

    </select>

    <delete id="deleteStudentCommentByCommentId">
        delete
        from
            student_comment_tb
        where
            student_comment_id = #{studentCommentId}

    </delete>

    <update id="updateCommentByCommentId" parameterType="com.meeteam4.meeting.entity.StudentComment">
        update
            student_comment_tb
        set
            comment = #{comment}
        where
            student_comment_id = #{studentCommentId}

    </update>


    <insert id="saveTeacherBoard" parameterType="com.meeteam4.meeting.entity.TeacherBoard">
        insert into
            teacher_board_tb
        values(
            0,
            #{teacherId},
            #{title},
            #{content},
            #{viewCount},
            now(),
            now()
            )
    </insert>

    <select id="searchTeacherBoard" resultMap="BoardTcResultMap">
        select
            teacher_board_id,
            teacher_id,
            title,
            create_date,
            view_count
        from
            teacher_board_tb
        where
            1=1
        <choose>
            <when test="count != -1 ">
                and(
                title like concat('%', #{searchText},'%')
                )
            </when>
        </choose>
        limit #{startIndex}, #{count}

    </select>

    <select id="getTeacherCount" resultType="integer">
        select
            count(*)
        from
            teacher_board_tb
        where
            1=1
        <choose>
            <when test="count != -1 ">
                and(
                title like concat('%', #{searchText},'%')
                )
            </when>
        </choose>

    </select>

    <select id="getSingleTeacherBoard" resultMap="BoardTcResultMap">
        select
            teacher_board_id,
            title,
            create_date,
            content,
            view_count
        from
            teacher_board_tb
        where
            teacher_board_id = #{teacherBoardId};

    </select>

    <delete id="deleteTeacherBoardByBoardId">
        delete
        from
            teacher_board_tb
        where
            teacher_board_id = #{teacherBoardId}

    </delete>

    <update id="updateTeacherBoardByBoardId" parameterType="com.meeteam4.meeting.entity.TeacherBoard">
        update
            teacher_board_tb
        set
            title = #{title},
            content = #{content},
            update_date = now()
        where
            teacher_board_id = #{teacherBoardId}

    </update>

    <insert id="saveTeacherComment" parameterType="com.meeteam4.meeting.entity.TeacherComment">
        insert into
            teacher_comment_tb
        values(
            0,
            #{teacherBoardId},
            #{teacherId},
            #{comment},
            now(),
            now()
        )

    </insert>

    <select id="getTeacherComment" resultMap="TeacherCommentResultMap">
        select
            teacher_comment_id,
            teacher_board_id,
            teacher_id,
            comment,
            create_date,
            update_date
        from
            teacher_comment_tb
        where
            teacher_board_id = #{teacherBoardId};

    </select>

    <delete id="deleteTeacherCommentByCommentId">
        delete
        from
            teacher_comment_tb
        where
            teacher_comment_id = #{teacherCommentId}

    </delete>

    <update id="updateTeacherCommentByCommentId" parameterType="com.meeteam4.meeting.entity.TeacherComment">
        update
            teacher_comment_tb
        set
            comment = #{comment}
        where
            teacher_comment_id = #{teacherCommentId}

    </update>

    <insert id="saveStudyBoard" parameterType="com.meeteam4.meeting.entity.StudyBoard">
        insert into
            study_board_tb
        values(
            0,
            #{userId},
            #{title},
            #{content},
            #{viewCount},
            now(),
            now()
        )
    </insert>

    <select id="searchStudyBoard" resultMap="BoardStudyResultMap">
        select
            study_board_id,
            user_id,
            title,
            create_date,
            view_count
        from
            study_board_tb
        where
            1=1
        <choose>
            <when test="count != -1 ">
                and(
                title like concat('%', #{searchText},'%')
                )
            </when>
        </choose>
        limit #{startIndex}, #{count}

    </select>

    <select id="getStudyCount" resultType="integer">
        select
            count(*)
        from
            study_board_tb
        where
            1=1
        <choose>
            <when test="count != -1 ">
                and(
                title like concat('%', #{searchText},'%')
                )
            </when>
        </choose>

    </select>

    <select id="getSingleStudyBoard" resultMap="BoardStudyResultMap">
        select
            study_board_id,
            title,
            create_date,
            content,
            view_count
        from
            study_board_tb
        where
            study_board_id = #{studyBoardId};

    </select>

    <delete id="deleteStudyBoardByBoardId">
        delete
        from
        study_board_tb
        where
        study_board_id = #{studyBoardId}

    </delete>

    <update id="updateStudyBoardByBoardId" parameterType="com.meeteam4.meeting.entity.StudyBoard">
        update
            study_board_tb
        set
            title = #{title},
            content = #{content},
            update_date = now()
        where
            study_board_id = #{studyBoardId}

    </update>
</mapper>